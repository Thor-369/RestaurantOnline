<!DOCTYPE html>
<html lang="en">
<%- include('fragmentos/head'); %>

  <body style="background: linear-gradient(90deg, rgb(14, 0, 3), rgb(51, 18, 10));">
    <%- include('fragmentos/navbar'); %>

      <div class="container" style="margin-top: 0;">
        <div class="section section-signup page-header" style=" background-image: url(/assets/img/fondo.jpg)">
          <br>
          <div class="container" style="margin-top: 150px;">
            <div class="row">
              <div class="col-lg-5 col-md-6 mx-auto">
                <div class="card card-login">
                  <% if (user) { %>
                    <% if (!error) { %>
                      <form class="form" id="formularioEditar" data-id="<%= user._id %>">
                        <div class="card-header card-header-primary text-center">
                          <h4 class="card-title ">Editar Perfil</h4>

                        </div>
                        <div class="card-body">
                          <span class="bmd-form-group">
                            <div class="input-group">
                              <div class="input-group-prepend">
                                <span class="input-group-text">
                                  <i class="fa fa-user-circle-o" aria-hidden="true"></i>
                                </span>
                              </div>
                              <input type="text" class="form-control" placeholder="Nombres" name="name"
                                value="<%= user.name %>" id="nameInput">
                            </div>
                          </span>
                          <span class="bmd-form-group">
                            <div class="input-group">
                              <div class="input-group-prepend">
                                <span class="input-group-text">
                                  <i class="fa fa-envelope"> </i>
                                </span>
                              </div>
                              <input type="email" class="form-control" placeholder="Email" name="email"
                                value="<%= user.email %>" id="emailInput">
                            </div>
                          </span>
                          <span class="bmd-form-group">
                            <div class="input-group">
                              <div class="input-group-prepend">
                                <span class="input-group-text">
                                  <i class="fa fa-address-card"> </i>
                                </span>
                              </div>
                              <input type="text" class="form-control" placeholder="Dirección" name="dir"
                                value="<%= user.dir %>" id="dirInput">
                            </div>
                          </span>
                        </div>
                        <div class="footer text-center">
                          <div class=" bg-warning">
                            <p class="col-md-9 mx-auto text-center">Si cambias tu correo deberás usar el nuevo para
                              poder
                              acceder a tu cuenta.</p>
                          </div>
                          <button class="btn btn-warning btn-block" type="submit">
                            Editar
                        </button>
                        </div>
                      </form>
                      <% } %>

                        <% if (error) { %>
                          <div class="alert alert-danger" role="alert">
                            <%= msg %>
                          </div>
                          <% } %>
                            <% } %>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
  </body>
  <script>

    formularioEditar.addEventListener('submit', async (e) => {
      e.preventDefault()
      const name = formularioEditar.elements['nameInput'].value
      const email = document.querySelector('#emailInput').value
      const dir = document.querySelector('#dirInput').value
      const id = formularioEditar.dataset.id
      try {
        const data = await fetch(`/editar/${id}`, {
          method: 'put',
          headers: {
            'Content-Type': 'application/json'
          },
          body: JSON.stringify({ name, email, dir })
        })
        const res = await data.json()
        if (res.estado) {
          window.location.href = '/profile'
        } else {
          console.log(res)
        }
      } catch (error) {
        console.log(error)
      }
    })
  </script>

</html>